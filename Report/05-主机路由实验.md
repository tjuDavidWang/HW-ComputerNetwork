# 主机路由实验

2023/09/25

## 实验目的

本实验旨在通过Windows系统的Route命令，掌握主机路由的基本概念和操作，进一步理解路由表的动态维护和数据包的转发机制。

## 实验原理 

路由是一种网络通信机制，其核心任务是确定数据包从源主机到目标主机的最佳路径。在这个过程中，路由器扮演了至关重要的角色。它们不仅负责存储和管理路由表，还负责数据包的转发。

- **数据包转发与路由表**: 当一个数据包到达路由器的一个接口时，路由器首先会检查该数据包的目标IP地址。然后，它会在路由表中查找与这个IP地址最匹配的条目，以确定下一跳的地址和出口接口。
- **动态与静态路由**: 路由可以是静态设置的，也可以是动态更新的。静态路由通常由网络管理员手动配置，而动态路由则通过路由协议（如RIP, OSPF等）自动更新。
- **子网与子网掩码**: 在路由表中，除了目标IP地址外，还有一个重要的概念是子网掩码。它用于划分IP地址的网络部分和主机部分，以便路由器能更准确地匹配目标。
- **跃点数（Metric）**: 这是一个用于衡量到达目标地址所需成本的数值。路由器会优先选择跃点数最低的路径。
- **路由协议与路由算法**: 路由协议定义了路由器如何与其他路由器通信，以及如何更新其路由表。常见的路由协议有RIP, OSPF, BGP等。路由算法则是路由协议的核心，负责计算最佳路径。
- **主机路由**: 除了专用的路由器设备外，普通的计算机也可以进行路由。这通常是通过在操作系统级别配置路由表来实现的。这种情况下，计算机既是数据包的源或目标，也是转发数据包的设备。
- **命令行路由操作**: 在Windows系统中，`route`命令提供了一种手段，用于查看和修改主机级别的路由表。这对于网络故障排查和高级网络配置是非常有用的。

通过理解这些基础原理，我们可以更深入地掌握路由的工作机制，以及如何通过命令行工具进行路由配置和故障排查。

## 实验设备 

- 操作系统：Windows 10
- 网络环境：局域网
- 软件：命令提示符cmd

## 实验步骤

1. 打开命令提示符，注意要以管理员身份运行。

2. 使用`route PRINT`命令查看当前的路由表。

3. 记录显示的路由表项。

4. 使用`route ADD`命令添加新的路由。

   ```bash
   route ADD [目标网络] MASK [子网掩码] [网关地址] METRIC [跃点数]
   ```

5. 再次使用`route PRINT`命令，观察路由表的变化。

6. 使用`route CHANGE`命令尝试修改现有的路由。

   ```bash
   route CHANGE [目标网络] MASK [新子网掩码] [新网关地址] METRIC [新跃点数]
   ```

7. 再次使用`route PRINT`命令，观察路由表的变化。

8. 使用`route DELETE`命令删除刚才添加的路由。

   ```bash
   route DELETE [目标网络]
   ```

9. 再次使用`route PRINT`命令，观察路由表的变化。

## 实验现象

1. `route PRINT`命令显示了当前的IPv4和IPv6路由表。

   ![image-20230927192638738](C:\Users\12920\AppData\Roaming\Typora\typora-user-images\image-20230927192638738.png)

2. 使用`route ADD`后，新的路由项出现在路由表中。

   具体来说，使用命令 `route ADD 192.168.2.0 MASK 255.255.255.0 192.168.1.1 METRIC 2`，添加了一个到192.168.2.0网络，子网掩码为255.255.255.0，通过192.168.1.1网关，跃点数为2的路由，重新打印后发现IPv4中多了一行即为刚添加的内容。

   ![image-20230927192847357](C:\Users\12920\AppData\Roaming\Typora\typora-user-images\image-20230927192847357.png)

3. 使用`route CHANGE`后，选定的路由项得到修改。

   具体来说，使用命令`route CHANGE 192.168.2.0 MASK 255.255.255.0 192.168.1.2 METRIC 3`，修改到192.168.2.0网络的路由，将网关改为192.168.1.2，跃点数改为3，对应IPv4中内容也有变化。

   ![image-20230927193456355](C:\Users\12920\AppData\Roaming\Typora\typora-user-images\image-20230927193456355.png)

4. 使用`route DELETE`后，相应的路由项从路由表中消失。

   具体来说，使用 命令`route DELETE 192.168.2.0`，删除到192.168.2.0网络的路由

   ![image-20230927193208207](C:\Users\12920\AppData\Roaming\Typora\typora-user-images\image-20230927193208207.png)

## 分析讨论 

1. **记录实验内容结果**

   实验结果显示，路由表能够根据`route`命令动态地进行修改。

2. **查找资料，尝试解释显示条目含义**：

   - 网络目标（Network Destination）: 这是目标网络或主机的IP地址。它定义了该路由条目适用于哪些目标地址。
   - 网络掩码（Netmask）: 网络掩码与网络目标一起使用，以指定目标地址的范围。例如，一个掩码为255.255.255.0的目标网络192.168.1.0将包括从192.168.1.1到192.168.1.254的所有IP地址。
   - 网关（Gateway）: 这是下一跳路由器或目标主机的IP地址。数据包将被发送到这个地址，然后由该设备进一步转发。
   - 接口（Interface）: 这是本地主机上用于该路由的网络接口的IP地址。数据包将从这个接口出发，前往网关或最终目的地。
   - 跃点数（Metric）: 这是一个表示到达目标网络或主机所需成本的数值。它用于在存在多条可用路径时选择最佳路径。
   - 活动路由和永久路由: 活动路由是当前有效的路由，而永久路由是在系统重启后仍然有效的路由。
   - IPv4和IPv6路由表: `route PRINT`命令通常会显示IPv4和IPv6的路由表。这两者在地址结构和长度上有所不同，但基本的路由原理是相似的。
   - 在链路上（On-link）: 这表示目标地址可以直接通过本地接口到达，无需经过其他路由器。

   这些字段共同决定了数据包如何从源地址被路由到目标地址。理解这些字段的含义和作用是掌握网络路由基础的关键。